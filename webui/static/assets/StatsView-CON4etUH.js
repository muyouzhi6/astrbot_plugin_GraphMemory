import{d as F,r as g,w as P,o as q,A as D,h as V,i as t,j as p,m as O,T as B,u as w,q as G,t as b,f as C,G as E}from"./vendor-vue-BVRAD2HG.js";import{s as z}from"./stats-BSkFCfwg.js";import{i as T}from"./vendor-charts-Bb6yjXMn.js";import{L as j}from"./loader-circle-Cc_M7cjW.js";import{D as H}from"./database-Czx9rb0d.js";import{G as U}from"./git-fork-BS1LapYh.js";import{c as A}from"./createLucideIcon-B0lsOQ7f.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./client-CMhDoEMr.js";import"./vendor-utils-B9ygI19o.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=A("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=A("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),Q={class:"stats-view"},X={class:"view-content"},Y={key:0,class:"loading-state"},Z={key:1,class:"stats-container"},$={key:0,class:"stats-grid"},ee={class:"stat-card"},te={class:"stat-icon-wrapper blue"},se={class:"stat-content"},oe={class:"stat-value"},ae={class:"stat-card"},ie={class:"stat-icon-wrapper green"},le={class:"stat-content"},ne={class:"stat-value"},re={class:"stat-card"},ce={class:"stat-icon-wrapper purple"},de={class:"stat-content"},ue={class:"stat-value"},ve={class:"stat-card"},he={class:"stat-icon-wrapper orange"},fe={class:"stat-content"},ge={class:"stat-value"},pe={class:"charts-container"},me={class:"chart-card"},we={class:"chart-card"},Se=F({__name:"StatsView",setup(ye){const S=g(!0),c=g(null),n=g(null),r=g(null),d=g(),u=g();let o=null,a=null;const L=s=>{if(console.log("[StatsView] initPieChart called with:",s),!d.value){console.error("[StatsView] pieChartRef.value is null");return}if(!s||s.length===0){console.warn("[StatsView] No distribution data");return}try{o&&(o.dispose(),o=null),console.log("[StatsView] Initializing ECharts on element:",d.value),o=T(d.value);const e=getComputedStyle(document.documentElement),l=document.documentElement.getAttribute("data-theme")==="dark",i=l?"#e2e8f0":"#1f2937",v=l?"#1e293b":"#ffffff",h=l?"#334155":"#e5e7eb";console.log("[StatsView] Theme:",l?"dark":"light"),console.log("[StatsView] Theme colors:",{textColor:i,bgColor:v,borderColor:h});const y=s.map(_=>({value:_.count,name:_.type}));console.log("[StatsView] Chart data:",y);const f={tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)",backgroundColor:v,borderColor:h,textStyle:{color:i}},legend:{orient:"vertical",right:10,top:"center",textStyle:{color:i,fontSize:12}},series:[{name:"实体类型",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:v,borderWidth:2},label:{show:!1,position:"center",color:i},emphasis:{label:{show:!0,fontSize:20,fontWeight:"bold",color:i}},labelLine:{show:!1},data:y}]};o.setOption(f),console.log("[StatsView] Pie chart initialized successfully")}catch(e){console.error("[StatsView] Failed to initialize pie chart:",e)}},x=s=>{if(console.log("[StatsView] initLineChart called with:",s),!u.value){console.error("[StatsView] lineChartRef.value is null");return}if(!s||s.length===0){console.warn("[StatsView] No timeline data");return}try{a&&(a.dispose(),a=null),console.log("[StatsView] Initializing line chart on element:",u.value),a=T(u.value);const e=s.map(k=>k.date),l=s.map(k=>k.count);console.log("[StatsView] Line chart dates:",e),console.log("[StatsView] Line chart counts:",l);const i=document.documentElement.getAttribute("data-theme")==="dark",v=i?"#94a3b8":"#6b7280",h=i?"#334155":"#e5e7eb",y=i?"#1e293b":"#f3f4f6",f="#3b82f6",_=i?"#1e293b":"#ffffff",M=i?"#e2e8f0":"#1f2937";console.log("[StatsView] Line chart theme:",i?"dark":"light"),console.log("[StatsView] Line chart theme colors:",{textColorSecondary:v,borderColor:h,accentColor:f});const N={tooltip:{trigger:"axis",formatter:"{b}: {c} 个实体",backgroundColor:_,borderColor:h,textStyle:{color:M}},xAxis:{type:"category",data:e,axisLabel:{color:v},axisLine:{lineStyle:{color:h}}},yAxis:{type:"value",axisLabel:{color:v},axisLine:{lineStyle:{color:h}},splitLine:{lineStyle:{color:y}}},series:[{name:"实体数量",type:"line",smooth:!0,data:l,lineStyle:{color:f,width:2},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:f+"40"},{offset:1,color:f+"00"}]}},itemStyle:{color:f}}]};a.setOption(N),console.log("[StatsView] Line chart initialized successfully")}catch(e){console.error("[StatsView] Failed to initialize line chart:",e)}},R=()=>{o==null||o.resize(),a==null||a.resize()},I=async()=>{console.log("[StatsView] initCharts called"),await E(),await E(),setTimeout(()=>{console.log("[StatsView] After transition delay"),console.log("[StatsView] pieChartRef.value:",d.value),console.log("[StatsView] lineChartRef.value:",u.value),n.value&&n.value.length>0&&d.value?(console.log("[StatsView] Initializing pie chart"),L(n.value)):console.error("[StatsView] Cannot init pie chart:",{hasData:!!(n.value&&n.value.length>0),hasRef:!!d.value}),r.value&&r.value.length>0&&u.value?(console.log("[StatsView] Initializing line chart"),x(r.value)):console.error("[StatsView] Cannot init line chart:",{hasData:!!(r.value&&r.value.length>0),hasRef:!!u.value})},350)};P(S,async(s,e)=>{console.log("[StatsView] Loading changed:",{from:e,to:s}),e===!0&&s===!1&&(console.log("[StatsView] Loading finished, initializing charts"),await I())});let m=null;return q(async()=>{console.log("[StatsView] Component mounted"),S.value=!0;try{const[s,e,l]=await Promise.all([z.getOverview(),z.getEntityTypes(),z.getTimeline()]);console.log("[StatsView] API responses:",{statsRes:s,typesRes:e,timelineRes:l}),s.success&&(c.value=s.data,console.log("[StatsView] Stats loaded:",c.value)),e.success&&(n.value=e.data.distribution,console.log("[StatsView] Entity types loaded:",n.value)),l.success&&(r.value=l.data.timeline,console.log("[StatsView] Timeline loaded:",r.value))}catch(s){console.error("[StatsView] Failed to load stats data:",s)}finally{S.value=!1,console.log("[StatsView] Loading finished")}m=new MutationObserver(s=>{s.forEach(e=>{e.type==="attributes"&&e.attributeName==="data-theme"&&(console.log("[StatsView] Theme changed, reinitializing charts"),o&&n.value&&L(n.value),a&&r.value&&x(r.value))})}),m.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),window.addEventListener("resize",R)}),D(()=>{window.removeEventListener("resize",R),m==null||m.disconnect(),o==null||o.dispose(),a==null||a.dispose()}),(s,e)=>(C(),V("div",Q,[e[7]||(e[7]=t("div",{class:"view-header"},[t("h2",null,"统计分析")],-1)),t("div",X,[p(B,{name:"fade",mode:"out-in"},{default:O(()=>[S.value?(C(),V("div",Y,[p(w(j),{class:"spinner",size:40}),e[0]||(e[0]=t("p",null,"加载统计数据...",-1))])):(C(),V("div",Z,[c.value?(C(),V("div",$,[t("div",ee,[t("div",te,[p(w(H),{size:24})]),t("div",se,[e[1]||(e[1]=t("div",{class:"stat-label"},"实体总数",-1)),t("div",oe,b(c.value.total_entities),1)])]),t("div",ae,[t("div",ie,[p(w(U),{size:24})]),t("div",le,[e[2]||(e[2]=t("div",{class:"stat-label"},"关系总数",-1)),t("div",ne,b(c.value.total_relations),1)])]),t("div",re,[t("div",ce,[p(w(J),{size:24})]),t("div",de,[e[3]||(e[3]=t("div",{class:"stat-label"},"会话数",-1)),t("div",ue,b(c.value.total_sessions),1)])]),t("div",ve,[t("div",he,[p(w(K),{size:24})]),t("div",fe,[e[4]||(e[4]=t("div",{class:"stat-label"},"用户数",-1)),t("div",ge,b(c.value.total_users),1)])])])):G("",!0),t("div",pe,[t("div",me,[e[5]||(e[5]=t("div",{class:"chart-header"},[t("h3",null,"实体类型分布")],-1)),t("div",{ref_key:"pieChartRef",ref:d,class:"chart"},null,512)]),t("div",we,[e[6]||(e[6]=t("div",{class:"chart-header"},[t("h3",null,"实体创建趋势")],-1)),t("div",{ref_key:"lineChartRef",ref:u,class:"chart"},null,512)])])]))]),_:1})])]))}}),Te=W(Se,[["__scopeId","data-v-33d40577"]]);export{Te as default};
