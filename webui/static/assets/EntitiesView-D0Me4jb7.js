import{d as q,r as d,o as A,h as a,i as e,q as k,l as w,v as Q,D as S,E as G,t as l,F as x,C as $,k as H,f as o,x as J,B as K,j as D,u as N}from"./vendor-vue-BVRAD2HG.js";import{a as E}from"./client-CMhDoEMr.js";import{c as O}from"./createLucideIcon-B0lsOQ7f.js";import{T as R}from"./trash-2-CKPxamVF.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-utils-B9ygI19o.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=O("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),V={list:p=>E.get("/entities",{params:p}),get:p=>E.get(`/entities/${p}`),delete:(p,_)=>E.delete(`/entities/${p}`,{params:_})},Y={class:"entities-view"},Z={class:"view-content"},ee={class:"filters"},te={key:0,class:"loading"},se={key:1,class:"error"},le={key:2,class:"empty"},ae={key:3,class:"table-container"},oe={class:"table"},ne={class:"entity-name"},ie={class:"description"},de=["title"],ce={class:"importance-text"},ue={class:"actions"},re=["onClick"],ve=["onClick"],pe={key:4,class:"pagination"},_e=["disabled"],me={class:"page-info"},he=["disabled"],ye={class:"modal-content"},be={class:"modal-header"},fe={class:"modal-body"},ke={class:"detail-section"},ge={class:"detail-grid"},Ce={class:"detail-item"},we={class:"value"},xe={class:"detail-item"},$e={class:"value"},Ee={class:"detail-item"},Ve={class:"value"},Me={class:"detail-item"},Fe={class:"value"},Te={class:"detail-item"},ze={class:"value"},Be={class:"detail-item"},Se={class:"value"},De={class:"detail-item"},Ne={class:"value"},Ie={key:0,class:"detail-section"},Le={key:0,class:"relations-list"},Ue={class:"relation-arrow"},Pe={class:"relation-target"},je={class:"relation-type"},qe={key:1,class:"empty-text"},Ae={key:1,class:"detail-section"},Qe={key:0,class:"mentions-list"},Ge={class:"mention-session"},He={class:"mention-count"},Je={key:1,class:"empty-text"},Ke=q({__name:"EntitiesView",setup(p){const _=d(!1),m=d(""),g=d([]),h=d(0),u=d(20),r=d(0),b=d(""),f=d(""),C=d("importance"),i=d(null),c=d(null);let M=null;const v=async()=>{_.value=!0,m.value="";try{const n={limit:u.value,offset:r.value,sort_by:C.value,order:"desc"};b.value&&(n.search=b.value),f.value&&(n.type=f.value);const t=await V.list(n);t.success?(g.value=t.data.entities,h.value=t.data.total):m.value=t.message||"加载失败"}catch(n){m.value="加载实体列表失败",console.error(n)}finally{_.value=!1}},I=()=>{clearTimeout(M),M=setTimeout(()=>{r.value=0,v()},500)},L=()=>{r.value>=u.value&&(r.value-=u.value,v())},U=()=>{r.value+u.value<h.value&&(r.value+=u.value,v())},P=async n=>{i.value=n,c.value=null;try{const t=await V.get(n.name);t.success&&(c.value=t.data)}catch(t){console.error("Failed to load entity details:",t)}},j=async n=>{if(confirm(`确定要删除实体 "${n.name}" 吗？`))try{const t=await V.delete(n.name);t.success?(alert("删除成功"),v()):alert("删除失败: "+t.message)}catch(t){alert("删除失败"),console.error(t)}};return A(()=>{v()}),(n,t)=>{var F,T,z,B;return o(),a("div",Y,[t[18]||(t[18]=e("div",{class:"view-header"},[e("h2",null,"实体管理")],-1)),e("div",Z,[e("div",ee,[w(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>b.value=s),type:"text",class:"input",placeholder:"搜索实体名称...",onInput:I},null,544),[[Q,b.value]]),w(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>f.value=s),class:"select",onChange:v},[...t[5]||(t[5]=[G('<option value="" data-v-ae439db6>所有类型</option><option value="人物" data-v-ae439db6>人物</option><option value="地点" data-v-ae439db6>地点</option><option value="事物" data-v-ae439db6>事物</option><option value="概念" data-v-ae439db6>概念</option><option value="事件" data-v-ae439db6>事件</option>',6)])],544),[[S,f.value]]),w(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>C.value=s),class:"select",onChange:v},[...t[6]||(t[6]=[e("option",{value:"importance"},"按重要性",-1),e("option",{value:"access_count"},"按访问次数",-1),e("option",{value:"created_at"},"按创建时间",-1)])],544),[[S,C.value]]),e("button",{onClick:v,class:"btn"},"刷新")]),_.value?(o(),a("div",te,"加载中...")):m.value?(o(),a("div",se,l(m.value),1)):g.value.length===0?(o(),a("div",le,[...t[7]||(t[7]=[e("p",null,"暂无实体数据",-1)])])):(o(),a("div",ae,[e("table",oe,[t[8]||(t[8]=e("thead",null,[e("tr",null,[e("th",null,"名称"),e("th",null,"类型"),e("th",null,"描述"),e("th",null,"重要性"),e("th",null,"访问次数"),e("th",null,"操作")])],-1)),e("tbody",null,[(o(!0),a(x,null,$(g.value,s=>(o(),a("tr",{key:s.name},[e("td",ne,l(s.name),1),e("td",null,[e("span",{class:J(["type-badge",`type-${s.type.toLowerCase()}`])},l(s.type),3)]),e("td",ie,l(s.description),1),e("td",null,[e("div",{class:"importance-bar",title:`重要性: ${s.importance}`},[e("div",{class:"importance-fill",style:K({width:`${s.importance*100}%`})},null,4),e("span",ce,l(s.importance.toFixed(2)),1)],8,de)]),e("td",null,l(s.access_count),1),e("td",null,[e("div",ue,[e("button",{onClick:y=>P(s),class:"btn-action",title:"查看详情"},[D(N(X),{size:16})],8,re),e("button",{onClick:y=>j(s),class:"btn-action btn-danger",title:"删除"},[D(N(R),{size:16})],8,ve)])])]))),128))])])])),h.value>u.value?(o(),a("div",pe,[e("button",{onClick:L,class:"btn btn-sm",disabled:r.value===0}," 上一页 ",8,_e),e("span",me,l(Math.floor(r.value/u.value)+1)+" / "+l(Math.ceil(h.value/u.value)),1),e("button",{onClick:U,class:"btn btn-sm",disabled:r.value+u.value>=h.value}," 下一页 ",8,he)])):k("",!0)]),i.value?(o(),a("div",{key:0,class:"modal",onClick:t[4]||(t[4]=H(s=>i.value=null,["self"]))},[e("div",ye,[e("div",be,[t[9]||(t[9]=e("h3",null,"实体详情",-1)),e("button",{onClick:t[3]||(t[3]=s=>i.value=null),class:"btn-close"},"×")]),e("div",fe,[e("div",ke,[t[17]||(t[17]=e("h4",null,"基本信息",-1)),e("div",ge,[e("div",Ce,[t[10]||(t[10]=e("span",{class:"label"},"名称:",-1)),e("span",we,l(i.value.name),1)]),e("div",xe,[t[11]||(t[11]=e("span",{class:"label"},"类型:",-1)),e("span",$e,l(i.value.type),1)]),e("div",Ee,[t[12]||(t[12]=e("span",{class:"label"},"描述:",-1)),e("span",Ve,l(i.value.description),1)]),e("div",Me,[t[13]||(t[13]=e("span",{class:"label"},"重要性:",-1)),e("span",Fe,l(i.value.importance.toFixed(2)),1)]),e("div",Te,[t[14]||(t[14]=e("span",{class:"label"},"访问次数:",-1)),e("span",ze,l(i.value.access_count),1)]),e("div",Be,[t[15]||(t[15]=e("span",{class:"label"},"创建时间:",-1)),e("span",Se,l(i.value.created_at),1)]),e("div",De,[t[16]||(t[16]=e("span",{class:"label"},"最后访问:",-1)),e("span",Ne,l(i.value.last_accessed),1)])])]),c.value?(o(),a("div",Ie,[e("h4",null,"关系 ("+l(((F=c.value.relations)==null?void 0:F.length)||0)+")",1),(T=c.value.relations)!=null&&T.length?(o(),a("div",Le,[(o(!0),a(x,null,$(c.value.relations,(s,y)=>(o(),a("div",{key:y,class:"relation-item"},[e("span",Ue,l(s.direction==="outgoing"?"→":"←"),1),e("span",Pe,l(s.to||s.from),1),e("span",je,l(s.relation),1)]))),128))])):(o(),a("p",qe,"暂无关系"))])):k("",!0),c.value?(o(),a("div",Ae,[e("h4",null,"提及记录 ("+l(((z=c.value.mentioned_in)==null?void 0:z.length)||0)+")",1),(B=c.value.mentioned_in)!=null&&B.length?(o(),a("div",Qe,[(o(!0),a(x,null,$(c.value.mentioned_in,(s,y)=>(o(),a("div",{key:y,class:"mention-item"},[e("span",Ge,l(s.session_name),1),e("span",He,l(s.mention_count)+" 次",1)]))),128))])):(o(),a("p",Je,"暂无提及记录"))])):k("",!0)])])])):k("",!0)])}}}),et=W(Ke,[["__scopeId","data-v-ae439db6"]]);export{et as default};
