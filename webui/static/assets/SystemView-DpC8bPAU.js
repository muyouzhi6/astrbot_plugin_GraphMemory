import{d as M,r as o,o as N,h as g,i as s,q as U,t as l,l as p,v as x,n as j,J as B,f as w}from"./vendor-vue-BVRAD2HG.js";import{a as k}from"./client-CMhDoEMr.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-utils-B9ygI19o.js";const m={getStatus:()=>k.get("/system/status"),export:r=>k.get("/system/export",{params:r}),import:r=>k.post("/system/import",r),cleanup:r=>k.post("/system/cleanup",null,{params:r})},I={class:"system-view"},O={class:"view-content"},P={class:"card"},J={key:0,class:"status-grid"},T={class:"status-item"},q={class:"value"},A={class:"status-item"},F={class:"value"},z={class:"status-item"},G={class:"value"},H={class:"status-item"},K={class:"value"},Q={class:"status-item"},W={class:"value"},X={class:"status-item"},Y={class:"value"},Z={class:"card"},ss={class:"section"},es={class:"form-row"},ts=["disabled"],ls={key:0,class:"result-text"},as={class:"section"},os={class:"form-group"},ns=["disabled"],is={key:0,class:"result-text"},rs={class:"card"},us={class:"section"},ds={class:"form-row"},cs=["disabled"],vs={class:"section"},ps={class:"form-row"},ms=["disabled"],_s=M({__name:"SystemView",setup(r){const n=o(null),_=o(""),b=o(!1),u=o(""),d=o(""),C=o(!0),y=o(!1),c=o(""),f=o(.1),h=o(.95),i=o(!1),v=async()=>{try{const t=await m.getStatus();t.success&&(n.value=t.data)}catch(t){console.error("Failed to load status:",t)}},R=async()=>{b.value=!0,u.value="";try{const t={};_.value&&(t.persona_id=_.value);const e=await m.export(t);if(e.success){const a=new Blob([e.data.content],{type:"application/json"}),S=URL.createObjectURL(a),V=document.createElement("a");V.href=S,V.download=`graphmemory_export_${Date.now()}.json`,V.click(),URL.revokeObjectURL(S),u.value=`导出成功: ${e.data.entity_count} 个实体, ${e.data.relation_count} 条关系`}else u.value="导出失败: "+e.message}catch(t){u.value="导出失败",console.error(t)}finally{b.value=!1}},$=async()=>{if(!d.value.trim()){alert("请输入 JSON 数据");return}if(confirm("确定要导入图谱数据吗？")){y.value=!0,c.value="";try{const t=await m.import({content:d.value,merge:C.value});t.success?(c.value=`导入成功: ${t.data.imported_entities} 个实体, ${t.data.imported_relations} 条关系`,d.value="",v()):c.value="导入失败: "+t.message}catch(t){c.value="导入失败",console.error(t)}finally{y.value=!1}}},L=async()=>{if(confirm(`确定要清理重要性低于 ${f.value} 的实体吗？`)){i.value=!0;try{const t=await m.cleanup({action:"prune_low_importance",threshold:f.value});t.success?(alert(t.message),v()):alert("清理失败: "+t.message)}catch(t){alert("清理失败"),console.error(t)}finally{i.value=!1}}},D=async()=>{if(confirm(`确定要应用 ${h.value} 的时间衰减吗？`)){i.value=!0;try{const t=await m.cleanup({action:"apply_decay",threshold:h.value});t.success?(alert(t.message),v()):alert("应用失败: "+t.message)}catch(t){alert("应用失败"),console.error(t)}finally{i.value=!1}}};return N(()=>{v()}),(t,e)=>(w(),g("div",I,[e[21]||(e[21]=s("div",{class:"view-header"},[s("h2",null,"系统管理")],-1)),s("div",O,[s("div",P,[e[11]||(e[11]=s("h3",null,"系统状态",-1)),n.value?(w(),g("div",J,[s("div",T,[e[5]||(e[5]=s("span",{class:"label"},"版本:",-1)),s("span",q,l(n.value.version),1)]),s("div",A,[e[6]||(e[6]=s("span",{class:"label"},"Embedding Provider:",-1)),s("span",F,l(n.value.embedding_provider||"未配置"),1)]),s("div",z,[e[7]||(e[7]=s("span",{class:"label"},"LLM Provider:",-1)),s("span",G,l(n.value.llm_provider||"未配置"),1)]),s("div",H,[e[8]||(e[8]=s("span",{class:"label"},"实体总数:",-1)),s("span",K,l(n.value.total_entities),1)]),s("div",Q,[e[9]||(e[9]=s("span",{class:"label"},"关系总数:",-1)),s("span",W,l(n.value.total_relations),1)]),s("div",X,[e[10]||(e[10]=s("span",{class:"label"},"会话数:",-1)),s("span",Y,l(n.value.total_sessions),1)])])):U("",!0),s("button",{onClick:v,class:"btn",style:{"margin-top":"16px"}}," 刷新状态 ")]),s("div",Z,[e[15]||(e[15]=s("h3",null,"导入导出",-1)),s("div",ss,[e[12]||(e[12]=s("h4",null,"导出图谱",-1)),s("div",es,[p(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>_.value=a),type:"text",class:"input",placeholder:"人格ID（留空导出全部）"},null,512),[[x,_.value]]),s("button",{onClick:R,class:"btn",disabled:b.value},l(b.value?"导出中...":"导出"),9,ts)]),u.value?(w(),g("p",ls,l(u.value),1)):U("",!0)]),s("div",as,[e[14]||(e[14]=s("h4",null,"导入图谱",-1)),s("div",os,[s("label",null,[p(s("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=a=>C.value=a)},null,512),[[B,C.value]]),e[13]||(e[13]=j(" 合并模式（保留现有数据） ",-1))])]),p(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=a=>d.value=a),class:"textarea",placeholder:"粘贴 JSON 数据...",rows:"8"},null,512),[[x,d.value]]),s("button",{onClick:$,class:"btn btn-primary",disabled:y.value||!d.value},l(y.value?"导入中...":"导入"),9,ns),c.value?(w(),g("p",is,l(c.value),1)):U("",!0)])]),s("div",rs,[e[20]||(e[20]=s("h3",null,"图谱清理",-1)),s("div",us,[e[16]||(e[16]=s("h4",null,"清理低重要性实体",-1)),s("div",ds,[p(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>f.value=a),type:"number",class:"input",placeholder:"重要性阈值",min:"0",max:"1",step:"0.1"},null,512),[[x,f.value,void 0,{number:!0}]]),s("button",{onClick:L,class:"btn btn-danger",disabled:i.value},l(i.value?"清理中...":"清理"),9,cs)]),e[17]||(e[17]=s("p",{class:"hint"},"将删除重要性低于阈值的实体",-1))]),s("div",vs,[e[18]||(e[18]=s("h4",null,"应用时间衰减",-1)),s("div",ps,[p(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>h.value=a),type:"number",class:"input",placeholder:"衰减率",min:"0",max:"1",step:"0.05"},null,512),[[x,h.value,void 0,{number:!0}]]),s("button",{onClick:D,class:"btn",disabled:i.value},l(i.value?"应用中...":"应用"),9,ms)]),e[19]||(e[19]=s("p",{class:"hint"},"对所有实体和关系应用时间衰减",-1))])])])]))}}),gs=E(_s,[["__scopeId","data-v-e057b659"]]);export{gs as default};
