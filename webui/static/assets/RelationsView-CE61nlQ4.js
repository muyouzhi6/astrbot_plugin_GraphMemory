import{d as D,r as o,o as M,h as u,i as t,q as N,l as b,v as g,t as i,F as R,C as z,B as T,j as U,u as L,f as r}from"./vendor-vue-BVRAD2HG.js";import{a as k}from"./client-CMhDoEMr.js";import{T as P}from"./trash-2-CKPxamVF.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-utils-B9ygI19o.js";import"./createLucideIcon-B0lsOQ7f.js";const w={list:f=>k.get("/relations",{params:f}),delete:(f,d)=>k.delete("/relations",{params:{from_entity:f,to_entity:d}})},j={class:"relations-view"},q={class:"view-content"},A={class:"filters"},E={key:0,class:"loading"},I={key:1,class:"error"},G={key:2,class:"empty"},H={key:3,class:"table-container"},J={class:"table"},K={class:"entity-name"},O={class:"relation-type"},Q={class:"entity-name"},W=["title"],X={class:"strength-text"},Y={class:"evidence"},Z={class:"timestamp"},tt=["onClick"],et={key:4,class:"pagination"},st=["disabled"],lt={class:"page-info"},at=["disabled"],nt=D({__name:"RelationsView",setup(f){const d=o(!1),v=o(""),y=o([]),m=o(0),a=o(20),n=o(0),p=o(""),_=o(""),h=o(0),c=async()=>{d.value=!0,v.value="";try{const s={limit:a.value,offset:n.value};p.value&&(s.from_entity=p.value),_.value&&(s.to_entity=_.value),h.value>0&&(s.min_strength=h.value);const e=await w.list(s);e.success?(y.value=e.data.relations,m.value=e.data.total):v.value=e.message||"加载失败"}catch(s){v.value="加载关系列表失败",console.error(s)}finally{d.value=!1}},x=()=>{p.value="",_.value="",h.value=0,n.value=0,c()},C=()=>{n.value>=a.value&&(n.value-=a.value,c())},V=()=>{n.value+a.value<m.value&&(n.value+=a.value,c())},F=async s=>{if(confirm(`确定要删除关系 "${s.from} -> ${s.to}" 吗？`))try{const e=await w.delete(s.from,s.to);e.success?(alert("删除成功"),c()):alert("删除失败: "+e.message)}catch(e){alert("删除失败"),console.error(e)}},$=s=>{if(!s)return"-";try{return new Date(s).toLocaleString("zh-CN")}catch{return s}};return M(()=>{c()}),(s,e)=>(r(),u("div",j,[e[5]||(e[5]=t("div",{class:"view-header"},[t("h2",null,"关系管理")],-1)),t("div",q,[t("div",A,[b(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>p.value=l),type:"text",class:"input",placeholder:"起点实体..."},null,512),[[g,p.value]]),b(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>_.value=l),type:"text",class:"input",placeholder:"终点实体..."},null,512),[[g,_.value]]),b(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>h.value=l),type:"number",class:"input",placeholder:"最小强度",min:"0",max:"1",step:"0.1",style:{width:"150px"}},null,512),[[g,h.value,void 0,{number:!0}]]),t("button",{onClick:c,class:"btn"},"搜索"),t("button",{onClick:x,class:"btn"},"重置")]),d.value?(r(),u("div",E,"加载中...")):v.value?(r(),u("div",I,i(v.value),1)):y.value.length===0?(r(),u("div",G,[...e[3]||(e[3]=[t("p",null,"暂无关系数据",-1)])])):(r(),u("div",H,[t("table",J,[e[4]||(e[4]=t("thead",null,[t("tr",null,[t("th",null,"起点实体"),t("th",null,"关系"),t("th",null,"终点实体"),t("th",null,"强度"),t("th",null,"证据"),t("th",null,"更新时间"),t("th",null,"操作")])],-1)),t("tbody",null,[(r(!0),u(R,null,z(y.value,(l,B)=>(r(),u("tr",{key:B},[t("td",K,i(l.from),1),t("td",O,i(l.relation),1),t("td",Q,i(l.to),1),t("td",null,[t("div",{class:"strength-bar",title:`关联强度: ${l.strength}`},[t("div",{class:"strength-fill",style:T({width:`${l.strength*100}%`})},null,4),t("span",X,i(l.strength.toFixed(2)),1)],8,W)]),t("td",Y,i(l.evidence||"-"),1),t("td",Z,i($(l.last_updated)),1),t("td",null,[t("button",{onClick:ot=>F(l),class:"btn-action btn-danger",title:"删除"},[U(L(P),{size:16})],8,tt)])]))),128))])])])),m.value>a.value?(r(),u("div",et,[t("button",{onClick:C,class:"btn btn-sm",disabled:n.value===0}," 上一页 ",8,st),t("span",lt,i(Math.floor(n.value/a.value)+1)+" / "+i(Math.ceil(m.value/a.value)),1),t("button",{onClick:V,class:"btn btn-sm",disabled:n.value+a.value>=m.value}," 下一页 ",8,at)])):N("",!0)])]))}}),mt=S(nt,[["__scopeId","data-v-f0ad424e"]]);export{mt as default};
