<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphMemory WebUI</title>
    <script src="https://unpkg.com/force-graph@1.43.5/dist/force-graph.min.js"></script>
    <script src="https://unpkg.com/lucide@0.344.0/dist/umd/lucide.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            overflow: hidden;
            background: #f2f2f2;
            color: #333;
            transition: background 0.3s, color 0.3s;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        body.dark { background: #080808; color: #e0e0e0; }
        
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 2px; }
        body.dark ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); }
        
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0,0,0,0.05);
        }
        body.dark .glass {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .loader {
            border: 2px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top: 2px solid #000;
            width: 16px; height: 16px;
            animation: spin 0.8s linear infinite;
        }
        body.dark .loader { border-color: rgba(255,255,255,0.1); border-top-color: #fff; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .fade-in { animation: fadeIn 0.2s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .hidden { display: none !important; }
        
        #login-screen {
            position: fixed; inset: 0; z-index: 100;
            display: flex; align-items: center; justify-content: center;
            background: #f2f2f2;
        }
        body.dark #login-screen { background: #080808; }
        
        #login-box {
            padding: 3rem 2.5rem; border-radius: 1rem;
            width: 100%; max-width: 24rem; text-align: center;
        }
        
        #login-box input {
            width: 100%; padding: 0.75rem 1rem;
            border: none; border-bottom: 1px solid #ccc;
            background: transparent; text-align: center;
            font: 0.875rem 'Courier New', monospace;
            letter-spacing: 0.2em; outline: none;
            transition: border-color 0.2s;
            color: #333;
        }
        #login-box input:focus { border-bottom-color: #000; }
        body.dark #login-box input { color: #e0e0e0; border-bottom-color: #666; }
        body.dark #login-box input:focus { border-bottom-color: #fff; }
        
        #login-box button {
            width: 100%; padding: 0.75rem; margin-top: 1.5rem;
            background: #000; color: #fff;
            border: none; font-size: 0.75rem; font-weight: 600;
            letter-spacing: 0.2em; text-transform: uppercase;
            cursor: pointer; transition: opacity 0.2s;
        }
        #login-box button:hover { opacity: 0.8; }
        body.dark #login-box button { background: #fff; color: #000; }
        
        #header {
            position: fixed; top: 0; left: 0; right: 0; height: 3.5rem;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 1.5rem; z-index: 50;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
            transition: background 0.3s, border-color 0.3s;
        }
        body.dark #header {
            background: rgba(8, 8, 8, 0.95);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        #header-left { display: flex; align-items: center; gap: 0.75rem; }
        #header-right { display: flex; align-items: center; gap: 1rem; }
        
        #stats {
            padding: 0.375rem 0.75rem; border-radius: 9999px;
            font: 0.75rem 'Courier New', monospace;
            color: #666;
        }
        body.dark #stats { color: #999; }
        
        .icon-btn {
            width: 2rem; height: 2rem; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            border: none; background: transparent;
            cursor: pointer; transition: background 0.2s;
            color: inherit; /* 继承父元素颜色 */
        }
        .icon-btn:hover { background: rgba(0,0,0,0.05); }
        body.dark .icon-btn:hover { background: rgba(255,255,255,0.05); }
        
        /* 侧边栏布局调整 (Flex Item) */
        #content-wrapper {
            display: flex;
            flex: 1;
            margin-top: 3.5rem; /* Header height */
            height: calc(100vh - 3.5rem);
            overflow: hidden;
        }

        #sidebar {
            width: 20rem;
            display: flex; flex-direction: column;
            padding: 1.5rem;
            border-right: 1px solid rgba(0,0,0,0.05);
            background: #f2f2f2;
            transition: width 0.3s ease-in-out, padding 0.3s ease-in-out, opacity 0.3s;
            overflow: hidden; /* 防止内部内容溢出 */
            flex-shrink: 0;
        }
        body.dark #sidebar {
            border-right: 1px solid rgba(255,255,255,0.05);
            background: #080808;
        }
        #sidebar.closed {
            width: 0;
            padding: 1.5rem 0;
            opacity: 0;
            border-right: none;
        }
        
        /* 侧边栏内部滚动区域 */
        .sidebar-scroll {
            flex: 1;
            overflow-y: auto;
            margin-right: -0.5rem; /* 隐藏滚动条 */
            padding-right: 0.5rem;
        }

        /* 图谱容器自适应 */
        #graph-container {
            flex: 1;
            position: relative; /* 相对定位 */
            z-index: 1;
            overflow: hidden;
        }
        
        #sidebar input[type="text"],
        #sidebar textarea {
            width: 100%; padding: 0.625rem 0.75rem;
            background: rgba(0,0,0,0.05); border: none;
            border-radius: 0.5rem; font-size: 0.875rem;
            outline: none; transition: background 0.2s;
            color: #333;
        }
        body.dark #sidebar input[type="text"],
        body.dark #sidebar textarea {
            background: rgba(255,255,255,0.05);
            color: #e0e0e0;
        }
        #sidebar input[type="text"]:focus,
        #sidebar textarea:focus {
            background: rgba(0,0,0,0.08);
        }
        body.dark #sidebar input[type="text"]:focus,
        body.dark #sidebar textarea:focus {
            background: rgba(255,255,255,0.08);
        }
        
        .tabs {
            display: flex; padding: 0.25rem;
            background: rgba(0,0,0,0.05); border-radius: 0.5rem;
        }
        body.dark .tabs { background: rgba(255,255,255,0.05); }
        
        .tab {
            flex: 1; padding: 0.375rem 0;
            border: none; background: transparent;
            font-size: 0.75rem; font-weight: 500;
            cursor: pointer; border-radius: 0.375rem;
            transition: all 0.2s;
            color: #666;
        }
        body.dark .tab {
            color: #999;
        }
        .tab.active {
            background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            color: #000;
        }
        body.dark .tab.active {
            background: rgba(255,255,255,0.1);
            color: #fff;
        }

        /* 监控面板样式 */
        .monitor-log-area {
            height: 200px;
            overflow-y: auto;
            background: rgba(0,0,0,0.03);
            border-radius: 0.5rem;
            padding: 0.75rem;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            color: #333;
            margin-bottom: 1rem;
        }
        body.dark .monitor-log-area {
            background: rgba(255,255,255,0.05);
            color: #ccc;
        }
        .log-entry {
            padding: 0.1rem 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        body.dark .log-entry {
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .log-entry[data-level="ERROR"] { color: #ef4444; }
        .log-entry[data-level="WARNING"] { color: #f97316; }
        
        .btn {
            width: 100%; padding: 0.5rem; margin-top: 0.5rem;
            border: none; border-radius: 0.5rem;
            font-size: 0.75rem; font-weight: 600;
            cursor: pointer; transition: all 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 0.5rem;
        }
        .btn-primary {
            background: #000; color: #fff;
        }
        .btn-primary:hover { opacity: 0.9; }
        body.dark .btn-primary { background: #fff; color: #000; }
        
        .btn-secondary {
            background: rgba(0,0,0,0.05);
            color: #333;
        }
        .btn-secondary:hover { background: rgba(0,0,0,0.1); }
        body.dark .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
        }
        body.dark .btn-secondary:hover { background: rgba(255,255,255,0.2); }
        
        #node-info {
            padding: 1rem; border-radius: 0.75rem;
            background: rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.05);
        }
        body.dark #node-info {
            background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.05);
        }
        
        #bottom-controls {
            position: fixed; bottom: 1.5rem; right: 1.5rem;
            left: auto; transform: none;
            z-index: 50; padding: 0.5rem 1rem; border-radius: 9999px;
            display: flex; align-items: center; gap: 1rem;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        body.dark #bottom-controls {
            background: rgba(30, 30, 30, 0.9);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        }
        
        #tooltip {
            position: fixed; z-index: 100; pointer-events: none;
            padding: 0.375rem 0.75rem; border-radius: 0.375rem;
            background: rgba(0,0,0,0.9); color: #fff;
            font-size: 0.75rem; white-space: nowrap;
            transform: translate(-50%, calc(-100% - 10px));
        }
        body.dark #tooltip { background: rgba(255,255,255,0.9); color: #000; }
    </style>
</head>
<body>
    <!-- 登录界面 -->
    <div id="login-screen">
        <div id="login-box" class="glass">
            <div style="margin-bottom: 2rem;">
                <i data-lucide="network" style="width: 3rem; height: 3rem;"></i>
            </div>
            <h2 style="font-size: 1.25rem; font-weight: 300; letter-spacing: 0.1em; margin-bottom: 0.5rem;">图谱记忆</h2>
            <p style="font-size: 0.75rem; color: #999; margin-bottom: 2.5rem; letter-spacing: 0.05em;">可视化知识图谱</p>
            <input type="password" id="login-key" placeholder="访问密钥" />
            <button id="login-btn">连接</button>
            <p id="login-error" style="margin-top: 1.5rem; color: #ef4444; font-size: 0.75rem;"></p>
        </div>
    </div>

    <!-- 主界面 -->
    <div id="main-app" class="hidden">
        <!-- 顶部栏 -->
        <div id="header">
            <div id="header-left">
                <button id="sidebar-toggle-btn" class="icon-btn" style="margin-right: 0.5rem;">
                    <i data-lucide="menu" style="width: 1.25rem; height: 1.25rem;"></i>
                </button>
                <i data-lucide="network" style="width: 1.25rem; height: 1.25rem; margin-right: 0.5rem;"></i>
                <span style="font-weight: 700; font-size: 0.875rem; letter-spacing: 0.05em;">图谱记忆</span>
            </div>
            <div id="header-right">
                <div id="stats" class="glass">
                    <span id="node-count">0</span> 节点 · <span id="edge-count">0</span> 边
                </div>
                <button class="icon-btn" id="theme-toggle"><i data-lucide="sun" style="width: 1rem; height: 1rem;"></i></button>
                <button class="icon-btn" id="logout-btn"><i data-lucide="log-out" style="width: 1rem; height: 1rem;"></i></button>
            </div>
        </div>

        <div id="content-wrapper">
            <!-- 侧边栏 -->
            <aside id="sidebar">
                <div style="position: relative; margin-bottom: 1.5rem; flex-shrink: 0;">
                    <i data-lucide="search" style="position: absolute; left: 0.75rem; top: 0.625rem; width: 1rem; height: 1rem; color: #999;"></i>
                    <input type="text" id="search-input" placeholder="搜索节点..." style="padding-left: 2.5rem;" />
                </div>

                <div class="tabs" style="margin-bottom: 1.5rem; flex-shrink: 0;">
                    <button class="tab active" data-tab="info">信息</button>
                    <button class="tab" data-tab="debug">调试</button>
                    <button class="tab" data-tab="monitor">监控</button>
                </div>

                <div class="sidebar-scroll">
                    <!-- INFO Tab -->
                    <div id="tab-info">
                        <div id="node-info-empty" style="text-align: center; padding: 3rem 0; opacity: 0.4;">
                            <i data-lucide="mouse-pointer-2" style="width: 2rem; height: 2rem; margin: 0 auto 0.75rem; stroke-width: 1;"></i>
                            <p style="font-size: 0.75rem; letter-spacing: 0.05em;">选择一个节点</p>
                        </div>
                        <div id="node-info-detail" class="hidden"></div>
                    </div>

                    <!-- DEBUG Tab -->
                    <div id="tab-debug" class="hidden">
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; font-size: 0.625rem; font-weight: 700; color: #666; margin-bottom: 0.5rem; letter-spacing: 0.05em;">结构化查询</label>
                            <textarea id="debug-query" rows="4" placeholder="针对当前会话进行关键词和向量混合搜索..." style="width: 100%; padding: 0.625rem; background: rgba(0,0,0,0.05); border: none; border-radius: 0.5rem; font-family: 'Courier New', monospace; resize: vertical; color: inherit;"></textarea>
                        </div>
        
                        <button class="btn btn-primary" id="debug-search-btn">
                            <span id="debug-loader" class="loader hidden"></span>
                            <span id="debug-text">搜索</span>
                        </button>
                        <div id="debug-result" class="hidden" style="margin-top: 1rem;">
                            <div style="display: flex; justify-content: space-between; font-size: 0.625rem; font-family: 'Courier New', monospace; color: #666; margin-bottom: 0.75rem;">
                                <span>匹配结果</span>
                                <span id="debug-stats"></span>
                            </div>
                            <button class="btn btn-secondary" id="visualize-btn" style="background: rgba(34,197,94,0.1); color: #22c55e; border: 1px solid rgba(34,197,94,0.2);">
                                可视化结果
                            </button>
                            <pre id="debug-json" style="margin-top: 0.75rem; padding: 0.75rem; background: rgba(0,0,0,0.05); border-radius: 0.5rem; font-size: 0.625rem; font-family: 'Courier New', monospace; color: #666; overflow-x: auto; max-height: 10rem;"></pre>
                        </div>
                    </div>

                    <!-- MONITOR Tab -->
                    <div id="tab-monitor" class="hidden">
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; font-size: 0.625rem; font-weight: 700; color: #666; margin-bottom: 0.5rem; letter-spacing: 0.05em;">日志</label>
                            <div id="monitor-logs" class="monitor-log-area"></div>
                            <div style="display: flex; gap: 0.5rem;">
                                <select id="log-level-filter" class="btn btn-secondary" style="flex: 1; text-align: left;">
                                    <option value="ALL">所有等级</option>
                                    <option value="INFO">INFO</option>
                                    <option value="WARNING">WARNING</option>
                                    <option value="ERROR">ERROR</option>
                                </select>
                                <button id="log-pause-toggle" class="btn btn-secondary">暂停</button>
                                <button id="log-clear" class="btn btn-secondary">清空</button>
                            </div>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; font-size: 0.625rem; font-weight: 700; color: #666; margin-bottom: 0.5rem; letter-spacing: 0.05em;">任务</label>
                            <div id="monitor-tasks" class="monitor-log-area"></div>
                        </div>
                        <div>
                            <label style="display: block; font-size: 0.625rem; font-weight: 700; color: #666; margin-bottom: 0.5rem; letter-spacing: 0.05em;">消息</label>
                            <div id="monitor-messages" class="monitor-log-area"></div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- 图表 -->
            <div id="graph-container"></div>
        </div>

        <!-- 底部控制 -->
        <div id="bottom-controls">
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.75rem; font-weight: 500; color: #666;">
                <input type="checkbox" id="show-labels" checked style="width: 0.75rem; height: 0.75rem; cursor: pointer;" />
                <span>标签</span>
            </label>
            <div style="width: 1px; height: 1rem; background: rgba(0,0,0,0.1);"></div>
            <button class="icon-btn" id="reload-btn" title="重新加载"><i data-lucide="refresh-cw" style="width: 0.875rem; height: 0.875rem;"></i></button>
            <button class="icon-btn" id="fit-view-btn" title="适应窗口"><i data-lucide="maximize" style="width: 0.875rem; height: 0.875rem;"></i></button>
        </div>

        <!-- Tooltip -->
        <div id="tooltip" class="hidden"></div>
    </div>

    <script src="app.js"></script>
</body>
</html>