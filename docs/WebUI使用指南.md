# GraphMemory WebUI 使用指南

## 概述

GraphMemory WebUI 是一个基于 Vue 3 + TypeScript 的现代化图谱管理界面，提供图谱可视化、实体管理、关系管理、搜索测试、统计分析和系统管理等功能。

## 技术栈

### 后端
- **FastAPI**: Python Web 框架
- **KuzuDB**: 图数据库
- **Uvicorn**: ASGI 服务器

### 前端
- **Vue 3**: 前端框架 (Composition API)
- **TypeScript**: 类型安全
- **Vite**: 构建工具
- **Cytoscape.js**: 图谱可视化
- **ECharts**: 统计图表
- **Axios**: HTTP 客户端

## 启动 WebUI

### 配置

在插件配置中设置:

```json
{
  "webui_enabled": true,
  "webui_port": 8765,
  "webui_key": "your_secret_key"
}
```

### 访问

启动 AstrBot 后，WebUI 会自动启动。访问地址:

```
http://localhost:8765
```

## 功能说明

### 1. 登录页

**路径**: `/login`

**功能**:
- 输入访问密钥进行身份验证
- 密钥保存在 localStorage，下次自动登录

**使用**:
1. 输入配置中设置的 `webui_key`
2. 点击"登录"按钮
3. 验证成功后跳转到图谱视图

### 2. 图谱视图

**路径**: `/graph`

**功能**:
- 可视化展示知识图谱
- 支持会话图谱和全局图谱切换
- 节点大小表示实体重要性
- 边宽度表示关系强度
- 支持拖拽、缩放、搜索节点

**操作**:
- **切换视图**: 选择"会话图谱"或"全局图谱"
- **会话选择**: 在会话图谱模式下选择特定会话
- **搜索节点**: 输入实体名称快速定位
- **查看邻居**: 点击节点查看相关实体
- **拖拽节点**: 调整图谱布局
- **缩放**: 鼠标滚轮缩放图谱

**图例**:
- 节点颜色: 不同实体类型使用不同颜色
- 节点大小: 越大表示重要性越高
- 边宽度: 越粗表示关系越强

### 3. 实体管理

**路径**: `/entities`

**功能**:
- 查看所有实体列表
- 搜索和过滤实体
- 查看实体详情
- 编辑实体信息
- 删除实体
- 分页浏览

**操作**:
- **搜索**: 输入实体名称进行搜索
- **类型过滤**: 选择实体类型筛选
- **重要性过滤**: 设置最小重要性阈值
- **查看详情**: 点击实体名称查看完整信息
- **编辑**: 点击"编辑"按钮修改实体属性
- **删除**: 点击"删除"按钮移除实体
- **分页**: 使用底部分页控件浏览

**实体属性**:
- **名称**: 实体唯一标识
- **类型**: 人物/地点/事物/概念/事件
- **描述**: 实体详细描述
- **重要性**: 0-1 之间的数值
- **创建时间**: 实体首次提取时间
- **更新时间**: 最后一次更新时间

### 4. 关系管理

**路径**: `/relations`

**功能**:
- 查看所有关系列表
- 过滤关系
- 删除关系
- 分页浏览

**操作**:
- **起点过滤**: 输入起点实体名称
- **终点过滤**: 输入终点实体名称
- **强度过滤**: 设置最小关系强度
- **删除**: 点击"删除"按钮移除关系
- **分页**: 使用底部分页控件浏览

**关系属性**:
- **起点实体**: 关系的起始实体
- **关系类型**: 关系的语义描述
- **终点实体**: 关系的目标实体
- **强度**: 0-1 之间的数值，表示关系强弱
- **证据**: 支持该关系的原始文本
- **更新时间**: 最后一次更新时间

### 5. 搜索测试

**路径**: `/search`

**功能**:
- 测试三种搜索模式
- 查看搜索结果
- 对比不同搜索方式的效果

**搜索模式**:

#### 混合搜索
结合向量搜索和关键词搜索，提供最全面的结果。

**使用场景**: 日常搜索，平衡准确性和召回率

#### 向量搜索
基于语义相似度的搜索，使用 Embedding 模型。

**使用场景**: 语义相关的模糊搜索

#### 关键词搜索
基于关键词匹配的精确搜索。

**使用场景**: 精确查找特定实体

**操作**:
1. 选择搜索模式
2. 输入搜索查询
3. 设置返回结果数量 (Top K)
4. 点击"搜索"按钮
5. 查看搜索结果列表

### 6. 统计分析

**路径**: `/stats`

**功能**:
- 查看图谱统计概览
- 实体类型分布饼图
- 实体创建趋势折线图

**统计指标**:
- **实体总数**: 图谱中的实体数量
- **关系总数**: 图谱中的关系数量
- **会话数**: 记录的会话数量
- **用户数**: 记录的用户数量

**图表**:

#### 实体类型分布 (饼图)
展示不同类型实体的数量分布，帮助了解图谱的知识结构。

#### 实体创建趋势 (折线图)
展示每日实体创建数量的时间序列，帮助了解图谱的增长趋势。

**特性**:
- 支持明暗主题自动适配
- 响应式布局，自动调整大小
- 交互式图表，悬停显示详情

### 7. 系统管理

**路径**: `/system`

**功能**:
- 查看系统状态
- 导出图谱数据
- 导入图谱数据
- 清理图谱

#### 系统状态
显示当前系统的运行状态和配置信息:
- 版本号
- Embedding Provider
- LLM Provider
- 实体/关系/会话统计

#### 导出图谱
将图谱数据导出为 JSON 文件。

**操作**:
1. 可选: 输入人格 ID (留空导出全部)
2. 点击"导出"按钮
3. 浏览器自动下载 JSON 文件

**导出格式**:
```json
{
  "entities": [...],
  "relations": [...],
  "metadata": {...}
}
```

#### 导入图谱
从 JSON 文件导入图谱数据。

**操作**:
1. 选择导入模式:
   - **合并模式**: 保留现有数据，合并新数据
   - **覆盖模式**: 清空现有数据，导入新数据
2. 粘贴 JSON 数据到文本框
3. 点击"导入"按钮
4. 等待导入完成

**注意**: 导入前建议先导出备份

#### 图谱清理

**清理低重要性实体**:
删除重要性低于指定阈值的实体。

**操作**:
1. 设置重要性阈值 (0-1)
2. 点击"清理"按钮
3. 确认操作

**应用时间衰减**:
对所有实体和关系应用时间衰减，降低旧记忆的重要性。

**操作**:
1. 设置衰减率 (0-1，推荐 0.95)
2. 点击"应用"按钮
3. 确认操作

## 主题切换

WebUI 支持明暗主题切换。

**切换方式**:
- 点击右上角的主题切换按钮
- 主题设置保存在 localStorage

**主题特点**:
- **浅色主题**: 白色背景，黑色文字，适合白天使用
- **深色主题**: 黑色背景，白色文字，适合夜间使用
- 纯色设计，无渐变色
- 所有图表自动适配主题

## 快捷键

目前 WebUI 不支持快捷键，所有操作通过鼠标点击完成。

## 性能优化

### 大规模图谱
- 图谱视图支持虚拟化渲染
- 实体/关系列表支持分页加载
- 搜索结果限制数量

### 网络优化
- API 请求自动重试
- 搜索防抖 (500ms)
- 图表懒加载

## 故障排除

### 无法访问 WebUI
1. 检查 `webui_enabled` 是否为 `true`
2. 检查端口是否被占用
3. 查看 AstrBot 日志

### 登录失败
1. 检查 `webui_key` 配置是否正确
2. 清除浏览器 localStorage
3. 重新输入密钥

### 图谱无法加载
1. 检查数据库是否正常
2. 查看浏览器控制台错误
3. 刷新页面重试

### 图表不显示
1. 检查是否有数据
2. 调整浏览器窗口大小触发重绘
3. 切换主题重新渲染

## API 认证

WebUI 使用简单的密钥认证机制。

**认证方式**:
1. Query 参数: `?key=your_secret_key`
2. Header: `Authorization: Bearer your_secret_key`

**安全建议**:
- 使用强密钥 (至少 16 位随机字符)
- 不要在公网暴露 WebUI
- 定期更换密钥

## 开发说明

### 前端开发

```bash
cd webui-src
npm install
npm run dev
```

### 构建前端

```bash
cd webui-src
npm run build
```

构建产物输出到 `webui/static/` 目录。

### 后端开发

后端代码位于 `webui/` 目录:
- `app.py`: FastAPI 应用工厂
- `api/`: API 路由
- `schemas/`: 数据模型
- `utils/`: 工具函数

## 更新日志

### v0.5.0 (2025-12-18)
- ✅ 完整的 WebUI 实现
- ✅ 图谱可视化 (Cytoscape.js)
- ✅ 实体/关系管理
- ✅ 搜索测试 (混合/向量/关键词)
- ✅ 统计分析 (ECharts 图表)
- ✅ 系统管理 (导入/导出/清理)
- ✅ 明暗主题切换
- ✅ 响应式设计

## 反馈和建议

如有问题或建议，请提交 Issue 或 Pull Request。

---

**文档版本**: 1.0
**最后更新**: 2025-12-18
**状态**: 已完成
